---
title: "Demo"
author: "Richel J.C. Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This demo shows how to determine which parts of proteins
bind strongly to MHC2 alleles. NetMHCIIpan is a tool that
estimates the binding strength of protein epitopes
to MHC2 alleles. `netmhc2pan` allows to do so from R.

```{r}
library(netmhc2pan)
```

This demo assumes NetMHCIIpan is installed.
Installation cannot be done `netmhc2pan`, as one needs
to request a download link at 
[https://www.cbs.dtu.dk/services/NetMHCIIpan/](https://www.cbs.dtu.dk/services/NetMHCIIpan).

To install `netmhc2pan`, use `install_netmhc2pan` with the download link:

```
install_netmhc2pan("https://www.cbs.dtu.dk/download/33A6B0AC-0F2E-11E9-B4D1-8ABCB9CD16B5/")
```

The installation of `netmhc2pan` is checked, with
the goal of producing a helpful error message:

```{r}
tryCatch(
  check_netmhc2pan_installation(),
  error = function(e) message(e)
)
```

We work on a protein:

```{r}
fasta_filename <- system.file(
  "extdata", "example.fasta", package = "netmhc2pan"
)
message(readLines(fasta_filename), sep = "\n")
```

We need to pick an allele. There are many alleles:

```{r}
if (is_netmhc2pan_installed()) {
  all_alleles <- get_netmhc2pan_alleles()
  length(all_alleles)
}
```

We simply pick the first two alleles:

```{r}
if (is_netmhc2pan_installed()) {
  alleles <- all_alleles[1:2]
}
```

```{r}
if (is_netmhc2pan_installed()) {
  bindings <- run_netmhc2pan(
    fasta_filename = fasta_filename,
    alleles = alleles
  )
  knitr::kable(bindings)
}
```
